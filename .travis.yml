language: python
cache: pip
python:
- '3.7'
install:
- pip install awscli
- pip install aws-sam-cli
jobs:
  include:
  - stage: architecture
    skip_cleanup: true
    before_install:
    - bash ./scripts/aws_config.sh
    script:
    - aws cloudformation deploy --template-file ./templates/00-infra.yml --stack-name
      glaedis-infra-$TRAVIS_BRANCH --region=$AWS_DEFAULT_REGION --capabilities CAPABILITY_IAM --parameter-overrides
      RootDomain=$DOMAIN RegionalCertArn=$REGIONAL_CERT HostedZoneId=$HOSTED_ZONE_ID
      CloudFrontCertArn=$CLOUDFRONT_CERT EmailAddress=$EMAIL EnvironmentName=$TRAVIS_BRANCH --no-fail-on-empty-changeset
    - aws cloudformation deploy --template-file ./templates/01-vpc.yml --stack-name glaedis-vpc-$TRAVIS_BRANCH
      --parameter-overrides EnvironmentName=$TRAVIS_BRANCH --no-fail-on-empty-changeset

env:
  global:
  - AWS_DEFAULT_REGION=eu-west-1
  - DOMAIN=glaedis.com
  - EMAIL=simon.pichon@outlook.fr
  - secure: OFKl00OtZEN203RECSUWJEGwPNenMYqwRcH+M0RBAqZju5B4lsQqC2TRATNAadd8MdsKAWLl5C795EMH5z4K6PWgqUN/HcR0Xr/JZrw+OkYZURJEfjy1NIOict+5qB9XWCC4DZG+odCUkD1yA3o8SM+1x1cmbD0Qu1lMdk+I/PvaSwMnQFuPTYTpVkohMiPQ11EaZoQMJ8PNR5hEsoSrCKEufu9FQjMUiOU2RD2/Au8zLqj/GWLYGcOA3TBxK8rVzhxA7N3q5y20B3N7qKhBnXfJzWY70sI2/zP5O1B0wPc2Qot5GFhEdAKZKdRXjU1CvIy4t4SI3GiooAGtKtRSd/AxoNIOlfWUHmq78Q19KYeJONPhcRxwdw6WEjZ5C1Sqb3W/bdpDY8zYna+jhyzJX+PJN0VN+I/RiJMn1rGcVzQhVpMsb7nQY3BOIqXGK1xv0plhnpRHdANp/rIjtDdmP7bEsgpK2Fv2GsyTx4saVYiVDbfdclfPsDvXq6sVDO9H4baOa3zahpurh8IIeNBacFjCAJIxBVE2v1A/TnI9ePmFv63o8hqznwF6MkqFovfAvuJI3IE3qgCWDT7dsvEqFPAIC+xanbn++BYNnPca1ZR4Emxj3Z9GCxyJCKnMFxkucJg0xPBaBEdIcU36uIRXZfbw4Z3VbN7sJssFZHvXaH0=
  - secure: nnxqXIpeF6ggmA95s+firWjhYKlwqXBbEzpeZrpaOmjHmL1d9kjciubIVqFLdQrCXz/eLcvcFY0tHjGhClcoZS8yJ7sCbqedMSyGs+5jgOnYqm0e/Er5aH5/MpBruRo2LP+YgQdHuQyk7t0sKkQNhD71CuHkbZZ247l6lAf/SZ07MVLGmapZE4hpweCWHYjI3yNKoWnON0+pyI/QSc8wtnGQhB83CcgwOCq85LrGNcFczx4C/RPhIszrqrzbikBH+SdM1tRboK8jP8hn0mYkg4bXc6FKKqMtTEUggKMUTKdq/lntrwVVlhRFYcdtt64L9ez5eZvuORSK/UnjAmETRRN+XMQpJ2HdVaHZtTSiOJTkCsVrR/m2AHAEqkP4vgBmfcOQMMFMnrzXSrZlcUjYBkbaESO51G1fe5bNJF94Y1AxrtneaW+//umcSEjPE1K6Iq8aV/svbQvxYzevhnGWL/2h3LihRu4j0QeS3gf+3O+vsWtFDNPJnsnpZMCM5CT2oD2ye+G2Uj90G4j3JAAi3lU9eCKd5QjbusQLHYNijcb0h3jAQBXlzmYVc5r8hozbbc5lr9yQkfUA4GtiCdsST0IFQmk9dwdVATUIGAeyVUOGYUzKXliQc1lPp3QqcIQMI9zRKMCpmfiT5bqsBMP+6LtEFioTHRWkaDg5bwV8nvE=
  - secure: E7mEcpiBp8RPbPWmLLw3qBcciwQ4DqVaSw46xGhuVAuCB/O0XJd1ZG7nexexobHgScZ4DxIYUvM8pLxMKRHdOT1Rb1JinAiWJNER+hWRNdfkD6il/WOWOBekJlJ6cJSFUtN4gnzSqVl3ACjJ/UC1wPwoKvpabwegTh56I5Xp/1YNBjECeLiYE5erMMHaMsBPnf62WdcVZvm/Pl0YS/dkHyb2xkD2DwDGRzgCPRBrqoCmGMcv6HhtUFMB6yKq5ZcbgtI9+7wgyEpgCv0riJNIxlAErd6LLCh/MkwBkdOj/nX776Sv/Bi0eDNzmFO7fjWmb4PzB4GPw7qcPnnufIupLBu0gqV3W8AjVEbn5QZlgLfdkZR4aXT+h3QQPz2vvTni7VvZ4byJPaQbG+hZYQNC+96hD1i52Bg0SZUoKhzYOrU5UbcclfxWQIfmALCK764SsyLOrj/cgf+fxORewOpaq/6VjlptGAw/2ToIK9p71Pp/bBmF78ddpVnLr67Zzf+Nhn5bVF4oBoGCIPDqvsImwuMw1c95Monx7+0W6y6fvS4/rTdpVXEW3BYgP2WXJoubwDAt8Sc39POROxU04uzxLoW6uw4x5JyL+Vc0fkJpmzuLH5Ip3u9na1wmnaHqCzh3NFxcfjtDBXbaWNw0YWuH/oAtAiZ7HUxkYPD9X9FQ8RE=
  - secure: BbqmRuQgRhsntg1JiEj6Y3gbfRsa6BZfzhCfh0tBrEQ+EyGdnX7n91IjKp1OVIotq+v9kRJgoOorHHumb/c0qxz2dazEIhraEKw96TyZAtaJ8rCM/tzo6inOIGTZCADtAsjSoZLl38aB8mLLwxv1YkgHiwElx7IUo9X/X1HmEmxe93nRTlPuRcPMIJ3a8s3xnBzZKdnMS2DNWeSjVdFWl6MqAhj6xijWPvmg0+ich8Uy4JxKYLpH/Exv3++yHITZYMenYfDctiKFz6IX8a+MLmjoAZLtT/sVPADPS5n2j5uXMZVJmG84/7fzwR6jTcfeSOmtFl0DfSm+UNjR9miiSp5fYO0pYoOKOIftR/Hbf9ZMZY8aFiW487P5oaZWVe+wOvbqK9hO2fwBHn0VVWHw6leIJgMBkI9UUQNoW8Lb3gCVquzhrArTISo9yXXXwt60nV/Umh1BbCvP/lmoifHVALhFpawXqLW8VT3q8a6j7WlXJ0xGHA2zg+kXnsirUnnSx3m8/eczTwjPIu6ZjyEddRrGA7qxrhUoNXoUaLTKcztEArpceYpD4rJ6IVS/xMBFo5LJZGS812zPfNe7gGRDaUCm5rQHsxD4hs1xmyLYp77t+fezaxYx7DoorPq6hDrqEjpBhu8BHW7cfDgemDvU0RI1QV2sGPehjY00e103dkQ=
  - secure: IcsgsNHeuJvGyQ2zHIcvyVWkBqMfEq5FdN2KkfvMB3RxWbGV40HNv0gOgfblW09BCyFZvD8YcIFmlZp1Lc+WxHbNtHjANtuIKjPu2cx7G54DDZUHNqxOL+exr+SJ++mB5q6aPzOfltVBRZkVwe/LFCsMwXkrsp6nf1NQtXI8vz4ksWXwHJPeBaaRyNQItaXVSu+3jJsCs2rjCTGL4elZraRbYKBMKnVUrWn6uhaHuRdfZT5JnHvRUru2efQKFYdJvVEOtO+tHd3WzUq/I0JZjahRh7smuNDsNVBlEBcQ8RRmDubSQhnSGVKhF+CAmyEgX3Kyg9HcPAH0e5EieyluJ4NMt2UZQT6nt+Dx1dJztul2t11lxGVHrHcwv+o6Dn72z7mZLGn/dAn+SQsyMV0sLswk711MEMLPYy+axs7Jl551WJMbY0hOeVpk6pZRySGLH9NgaPiMo5UpWGleHrF5P5Hg7tdVLhhgUPzOuUAaaFMuEA1cis41koySXAx/qlrThUqmdSDEQLKEVSFXNF6ZjkVjEiLSKDis0/KfKgBY5UNH6cKLi+/wzw8NVBa+nEg8fsLZq3dVygH4Lt6P76BLox8DCSkKZN/FHpA27AcTurwgCGMvjmii5caApDdKWD5WCXIAPCT7AnYtom8NGe+V2iQ8zxIZs7MIC9tSvqkPw90=
