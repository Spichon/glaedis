AWSTemplateFormatVersion: 2010-09-09
Description: Code Bucket and SNS topic

Parameters:
  EmailAddress:
    Description: email address alerts will be sent to
    Type: String
  RootDomain:
    Type: String
    Description: Root domain associated with site
  EnvironmentName:
    Type: String
    Default: ""
    Description: Env domain dev or prod
  CloudFrontCertArn:
    Type: String
    Description: US-East-1 wildcard certificate required for cloudfront
  RegionalCertArn:
    Type: String
    Description: Eu-west-1 wildcard certificate
  HostedZoneId:
    Type: String
    Description: Id of route53 hosted zone

Resources:
  CodeBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub
        - glaedis-backend-${EnvironmentName}
        - { EnvironmentName: !Ref EnvironmentName }

  AlertSNSTopic:
    Type: AWS::SNS::Topic
    Properties:
      Subscription:
        - Endpoint: !Ref EmailAddress
          Protocol: "email"


Outputs:
  AlertSNSTopicArn:
    Description: "AlertSNSTopicArn"
    Value: !Ref AlertSNSTopic
    Export:
      Name: !Sub
        - Glaedis-${EnvironmentName}-AlertSNSTopicArn
        - { EnvironmentName: !Ref EnvironmentName }
  CodeBucketName:
    Description: "CodeBucketName"
    Value: !Ref CodeBucket
    Export:
      Name: !Sub
        - Glaedis-${EnvironmentName}-CodeBucketName
        - { EnvironmentName: !Ref EnvironmentName }
  HostedZoneId:
    Description: "HostedZoneId"
    Value: !Ref HostedZoneId
    Export:
      Name: !Sub
        - Glaedis-${EnvironmentName}-HostedZoneId
        - { EnvironmentName: !Ref EnvironmentName }
  CloudFrontCertArn:
    Description: "CloudFrontCertArn"
    Value: !Ref CloudFrontCertArn
    Export:
      Name: !Sub
        - Glaedis-${EnvironmentName}-CloudFrontCertArn
        - { EnvironmentName: !Ref EnvironmentName }
  RegionalCertArn:
    Description: "RegionalCertArn"
    Value: !Ref RegionalCertArn
    Export:
      Name: !Sub
        - Glaedis-${EnvironmentName}-RegionalCertArn
        - { EnvironmentName: !Ref EnvironmentName }
  RootDomain:
    Description: "RootDomain"
    Value: !Ref RootDomain
    Export:
      Name: !Sub
        - Glaedis-${EnvironmentName}-RootDomain
        - { EnvironmentName: !Ref EnvironmentName }
  EnvironmentName:
    Description: "EnvironmentName"
    Value: !Ref EnvironmentName
    Export:
      Name: !Sub
        - Glaedis-${EnvironmentName}-EnvironmentName
        - { EnvironmentName: !Ref EnvironmentName }
